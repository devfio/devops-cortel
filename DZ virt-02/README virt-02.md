# Системы управления виртуализацией

1. Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

- 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий;
- Требуется наиболее производительное бесплатное opensource решение для виртуализации небольшой (20 серверов) инфраструктуры Linux и Windows виртуальных машин;
- Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры;
- Необходимо рабочее окружение для тестирование программного продукта на нескольких дистрибутивах Linux.

Ответ:

*Первый сценарий*. Для данного сценария подойдёт система виртуализации VMware vSphere, ESXi. ВМ поддерживают большинство ОС. Есть балансировщик нагрузки, поддержка сторонних систем резервного копирования и репликации, например, Veeam.

*Второй сценарий*. Для данного сценария подойдёт решение на KVM. ВМ на базе KVM поддерживает большинство ОС. Гипервизор KVM также позволяет выполнять виртуализацию как можно ближе к серверному оборудованию, что еще больше снижает задержки процессов. Решение бесплатное и имеет открытый исходный код.

*Третий сценарий*. Для данного сценария можно использовать Hyper-V Server. Это бесплатное решение, которое разработанно и поддерживается Microsoft. Соотвественно, идеально подойдёт для виртуализации Windows-инфраструктуры, обеспечит максимальную совместимость и оптимальную производительность.

*Четвёртый сценарий*. Для данного сценария подойдёт решение на KVM. ВМ на базе KVM поддерживает большинство ОС. Гипервизор KVM также позволяет выполнять виртуализацию как можно ближе к серверному оборудованию, что еще больше снижает задержки процессов. Решение бесплатное и имеет открытый исходный код.

2. Опишите сценарий миграции с VMware vSphere на Hyper-V для Linux и Windows виртуальных машин. Детально опишите необходимые шаги для использования всех преимуществ Hyper-V для Windows.

Ответ:

Для миграции с VMware vSphere на Microsoft Hyper-V существует несколько способов преобразования виртуальных машин:

1. System Center Virtual Machine Manager (VMM)
2. Преобразование VMDK в VHD и подключение конвертированного виртуального диска к новой виртуальной машине Hyper-V с помощью PowerShell
3. Microsoft Virtual Machine Converter (MVMC)
   Первым этапом является удаление инструментов VMware (VMware Tools) из ОС, удаление моментальных снимков (snapshots) с ВМ.

Первый способ хорошо описан в статье Microsoft - https://learn.microsoft.com/ru-ru/system-center/vmm/vm-convert-vmware?view=sc-vmm-2022

Второй способ требует использования следующих командлентов:
New-SCV2V -VMHost <Host> -VMXPath <string> [-EnableVMNetworkOptimization <bool>] [-EnableMACAddressSpoofing
<bool>] [-VMMServer <ServerConnection>] [-LibraryServer <LibraryServer>] [-JobGroup <guid>] [-Trigger] [-VhdType
{UnknownType | DynamicallyExpanding | FixedSize}] [-VhdFormat {VHD | VHDX}] [-Description <string>] [-Name
<string>] [-Owner <string>] [-UserRole <UserRole>] [-Path <string>] [-StartVM] [-CPUCount <byte>]
[-CPURelativeWeight <int>] [-CPUType <ProcessorType>] [-MemoryMB <int>] [-Generation <int>] [-DelayStartSeconds
<int>] [-StartAction {NeverAutoTurnOnVM | AlwaysAutoTurnOnVM | TurnOnVMIfRunningWhenVSStopped}] [-StopAction
{SaveVM | TurnOffVM | ShutdownGuestOS}] [-LogicalNetwork <LogicalNetwork>] [-VMNetwork <VMNetwork>]
[-NoConnection] [-MACAddress <string>] [-MACAddressType <string>] [-SourceNetworkConnectionID <string>]
[-VirtualNetwork <VirtualNetwork>] [-VirtualNetworkAdapter <VirtualNetworkAdapter>] [-VLanEnabled <bool>] [-VLanID
<uint16>] [-OverridePatchPath <string>] [-SkipInstallVirtualizationGuestServices] [-NetworkLocation <string>]
[-NetworkTag <string>] [-RunAsynchronously] [-PROTipID <guid>] [-JobVariable <string>]  [<CommonParameters>]

Третий способ преобразует виртуальную машину Hyper-V, преобразуя VMDK виртуальной машины VMware в формат VHD(X), повторно создавая виртуальную машину Hyper-V для достижения миграции.
Нужно установить MVMC. Далее идёт настройка конвертации, которая включает в себя:

- выбор типа конвертации (в нашем случае конвертация виртуальной машины);
- миграция на Hyper-V;
- указание целевого Hyper-V-хоста с IP-адресом и данными пользователя;
- выбор пути к хранилищу и формата диска ВМ;
- выбор источника с исходной ВМ для преобразования, указание данных пользователя;
- выбор необходимой ВМ из списка;
- выбор сосстояния исходной и целевой ВМ после конвертации;
- указание каталога для хранения временных файлов.
  Для Windows ВМ настройка параметров и установка сервисов интеграции Hyper-V довольно проста, но для Linux ВМ может потребоваться дополнительная конфигурация, например, ручная установка встроенных сервисов.

3. Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был бы выбор, то создавали ли вы бы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

   Ответ:

   Возможные проблемы и недостатки гетерогенной среды виртуализации:

   - трудны в освоении;
   - необходимость обучения сотрудников для работы в разных средах виртуализации;
   - осложнение технической поддержки инфраструктуры;
   - осложнение администрирования;
   - дороговизна обслуживания

   Минимизация рисков и проблем:

   - уменьшение числа совместного использования различных сред виртуализации;
   - применение провереных и рекомендуемых моделей использования гетерогенных сред;
   - автоматизация и тестирование гетерогенной среды виртуализации.

   Я бы старался не использовать гетерогенную среду виртуализации. При необходимости можно применять проверенные модели построения таких сред. Например, контейнерная и аппаратная виртуализация Docker + VMware vSphere.
